<div class="page-header">
  <div class="page-header-content">
    <div>
      <h1 class="page-title">Mis Entregas</h1>
      <p class="page-subtitle">Gestión de entregas y pedidos disponibles</p>
    </div>
  </div>
</div>

<div class="entregas-container">

  <!-- Mensaje de error -->
  <div class="alert alert-danger" *ngIf="mensajeError">
    <i class="fas fa-exclamation-circle"></i> {{ mensajeError }}
  </div>

  <!-- Loader -->
  <div class="loader" *ngIf="cargando">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>

  <!-- Mis entregas activas -->
  <section class="section-mis-entregas" *ngIf="!cargando">
    <h2 class="section-title">
      <i class="fas fa-truck"></i> Entregas Activas
      <span class="badge bg-primary">{{ misEntregas.length }}</span>
    </h2>

    <div class="entregas-grid" *ngIf="misEntregas.length > 0">
      <div class="entrega-card" *ngFor="let pedido of misEntregas">
        <div class="card-header">
          <span class="badge" [ngClass]="'bg-' + getEstadoColor(pedido.estado!)">
            {{ getEstadoTexto(pedido.estado!) }}
          </span>
          <span class="pedido-id">#{{ pedido.id?.substring(0, 8) }}</span>
        </div>

        <div class="card-body">
          <div class="info-group cliente-info">
            <h3>
              <i class="fas fa-user-circle"></i>
              {{ pedido.clienteNombre }}
            </h3>
            <div class="info-row">
              <i class="fas fa-phone"></i>
              <span>{{ pedido.clienteTelefono }}</span>
            </div>
          </div>

          <div class="info-group">
            <div class="info-row">
              <i class="fas fa-map-marker-alt"></i>
              <span class="info-value">{{ pedido.direccionEntrega }}</span>
            </div>
          </div>

          <div class="info-group">
            <div class="info-row">
              <i class="fas fa-box-open"></i>
              <span>
                <strong>{{ pedido.productos.length }} productos</strong>
                ({{ calcularTotalProductos(pedido.productos) }} items)
              </span>
            </div>
            <div class="info-row">
              <i class="fas fa-dollar-sign"></i>
              <span class="total-amount">{{ pedido.total?.toFixed(2) }}</span>
            </div>
          </div>

          <div class="observaciones" *ngIf="pedido.observaciones">
            <strong><i class="fas fa-comment-alt me-1"></i> Observaciones:</strong>
            <p class="obs-text">{{ pedido.observaciones }}</p>
          </div>

          <div class="fechas">
            <div class="info-row">
              <i class="fas fa-clock"></i>
              <small>Asignado: {{ pedido.fechaAsignacion | date:'short' }}</small>
            </div>
          </div>
        </div>

        <div class="card-actions">
          <button 
            class="btn btn-warning" 
            *ngIf="pedido.estado === 'ASIGNADO'"
            (click)="iniciarEntrega(pedido)">
            <i class="fas fa-truck-moving"></i> Iniciar Entrega
          </button>

          <button 
            class="btn btn-success" 
            *ngIf="pedido.estado === 'EN_CAMINO'"
            (click)="marcarEntregado(pedido)">
            <i class="fas fa-check-circle"></i> Marcar Entregado
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="misEntregas.length === 0">
      <i class="fas fa-inbox"></i>
      <p>No tienes entregas activas</p>
      <small>Toma pedidos disponibles para comenzar</small>
    </div>
  </section>

  <!-- Pedidos disponibles -->
  <section class="section-disponibles" *ngIf="!cargando">
    <h2 class="section-title">
      <i class="fas fa-box-open"></i> Pedidos Disponibles
      <span class="badge bg-success">{{ pedidosDisponibles.length }}</span>
    </h2>

    <div class="pedidos-grid" *ngIf="pedidosDisponibles.length > 0">
      <div class="pedido-card" *ngFor="let pedido of pedidosDisponibles">
        <div class="card-header">
          <span class="badge bg-success">Disponible</span>
          <span class="pedido-id">#{{ pedido.id?.substring(0, 8) }}</span>
        </div>

        <div class="card-body">
          <div class="info-group cliente-info">
            <h3>
              <i class="fas fa-user-circle"></i>
              {{ pedido.clienteNombre }}
            </h3>
            <div class="info-row">
              <i class="fas fa-phone"></i>
              <span>{{ pedido.clienteTelefono }}</span>
            </div>
          </div>

          <div class="info-group">
            <div class="info-row">
              <i class="fas fa-map-marker-alt"></i>
              <span class="info-value">{{ pedido.direccionEntrega }}</span>
            </div>
          </div>

          <div class="info-group">
            <div class="info-row">
              <i class="fas fa-box-open"></i>
              <span>
                {{ pedido.productos.length }} productos
                ({{ calcularTotalProductos(pedido.productos) }} items)
              </span>
            </div>
            <div class="info-row">
              <i class="fas fa-dollar-sign"></i>
              <span class="total-amount">{{ pedido.total?.toFixed(2) }}</span>
            </div>
          </div>

          <div class="observaciones" *ngIf="pedido.observaciones">
            <strong><i class="fas fa-comment-alt me-1"></i> Observaciones:</strong>
            <p class="obs-text">{{ pedido.observaciones }}</p>
          </div>

          <div class="fechas">
            <div class="info-row">
              <i class="fas fa-calendar-alt"></i>
              <small>Creado: {{ pedido.fechaCreacion | date:'short' }}</small>
            </div>
          </div>
        </div>

        <div class="card-actions">
          <button class="btn btn-primary" (click)="tomarPedido(pedido)">
            <i class="fas fa-hand-holding"></i> Tomar Pedido
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="pedidosDisponibles.length === 0">
      <i class="fas fa-check-circle"></i>
      <p>No hay pedidos disponibles en este momento</p>
      <small>Vuelve más tarde para ver nuevos pedidos</small>
    </div>
  </section>
</div>