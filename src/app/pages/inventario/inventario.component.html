<div class="page-header inventario">
  <div class="page-header-content">
    <div>
      <h1 class="page-title">Gesti√≥n de Inventario</h1>
      <p class="page-subtitle">
        Control y seguimiento de productos en tiempo real
      </p>
    </div>
    <div class="page-actions">
      <button class="btn btn-primary" (click)="openAddProductModal()">
        <i class="fas fa-plus"></i>
        Agregar Producto
      </button>
    </div>
  </div>
</div>

<div class="inventario-container">
  <!-- Controles superiores -->
  <div class="inventory-controls">
    <div class="search-controls">
      <input
        type="text"
        placeholder="Buscar productos..."
        class="search-input"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      />
      <select
        class="filter-select"
        [(ngModel)]="selectedCategory"
        (change)="onCategoryChange()"
      >
        <option value="">Todas las categor√≠as</option>
        <option value="Tecnolog√≠a">Tecnolog√≠a</option>
        <option value="Oficina">Oficina</option>
        <option value="Industrial">Industrial</option>
        <option value="Consumo">Consumo</option>
        <option value="Otros">Otros</option>
      </select>
      <button
        class="btn-secondary"
        (click)="clearFilters()"
        *ngIf="searchTerm || selectedCategory"
      >
        Limpiar Filtros
      </button>
    </div>
  </div>

  <!-- Resumen de inventario -->
  <div class="inventory-summary">
    <div class="summary-card" [class.loading]="loadingStats">
      <div class="summary-icon">üì¶</div>
      <div class="summary-content">
        <h3>{{ loadingStats ? "..." : formatNumber(stats.totalProducts) }}</h3>
        <p>Total Productos</p>
      </div>
    </div>
    <div class="summary-card" [class.loading]="loadingStats">
      <div class="summary-icon">üìä</div>
      <div class="summary-content">
        <h3>{{ loadingStats ? "..." : formatCurrency(stats.totalValue) }}</h3>
        <p>Valor Total</p>
      </div>
    </div>
    <div class="summary-card warning" [class.loading]="loadingStats">
      <div class="summary-icon">‚ö†Ô∏è</div>
      <div class="summary-content">
        <h3>{{ loadingStats ? "..." : stats.lowStock }}</h3>
        <p>Stock Bajo</p>
      </div>
    </div>
    <div class="summary-card success" [class.loading]="loadingStats">
      <div class="summary-icon">‚úÖ</div>
      <div class="summary-content">
        <h3>
          {{ loadingStats ? "..." : stats.totalProducts - stats.lowStock }}
        </h3>
        <p>Disponibles</p>
      </div>
    </div>
  </div>

  <!-- Tabla de productos -->
  <div class="inventory-table-container">
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner">Cargando productos...</div>
    </div>

    <table class="inventory-table" *ngIf="!loading">
      <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Producto</th>
          <th>Categor√≠a</th>
          <th>Stock Actual</th>
          <th>Stock M√≠nimo</th>
          <th>Precio Unitario</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let product of products"
          [class.low-stock]="product.stock <= product.minStock"
        >
          <td class="product-code">{{ product.code }}</td>
          <td class="product-name">
            <div class="product-info">
              <strong>{{ product.name }}</strong>
              <span class="product-description">{{ product.description }}</span>
            </div>
          </td>
          <td class="product-category">
            <span
              class="category-badge"
              [class]="getCategoryClass(product.category)"
            >
              {{ product.category }}
            </span>
          </td>
          <td class="stock-current">{{ product.stock }}</td>
          <td class="stock-min">{{ product.minStock }}</td>
          <td class="product-price">{{ formatCurrency(product.price) }}</td>
          <td class="product-status">
            <span class="status-badge" [class]="getStatusClass(product)">
              {{ getStatusText(product) }}
            </span>
          </td>
          <td class="product-actions">
            <button
              class="action-btn action-btn-edit"
              (click)="editProduct(product)"
              title="Editar"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="action-btn action-btn-view"
              (click)="updateStock(product)"
              title="Actualizar Stock"
            >
              <i class="fas fa-box"></i>
            </button>
            <button
              class="action-btn action-btn-delete"
              (click)="deleteProduct(product)"
              title="Eliminar"
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="products.length === 0">
          <td colspan="8" class="no-data">No se encontraron productos</td>
        </tr>
      </tbody>
    </table>

    <!-- Paginaci√≥n -->
    <div class="pagination" *ngIf="!loading && totalPages > 1">
      <button
        (click)="goToPage(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="pagination-btn"
      >
        ‚Üê Anterior
      </button>
      <span class="pagination-info">
        P√°gina {{ currentPage }} de {{ totalPages }} ({{
          totalProducts
        }}
        productos)
      </span>
      <button
        (click)="goToPage(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        class="pagination-btn"
      >
        Siguiente ‚Üí
      </button>
    </div>
  </div>

  <!-- Modal para agregar/editar producto -->
  <div class="modal show" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">
            {{ isEditing ? "Editar" : "Agregar" }} Producto
          </h2>
          <button class="btn-close" (click)="closeModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form class="product-form">
            <div class="form-group">
              <label class="form-label">C√≥digo del Producto</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="currentProduct.code"
                name="code"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Nombre del Producto</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="currentProduct.name"
                name="name"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Descripci√≥n</label>
              <textarea
                class="form-control"
                [(ngModel)]="currentProduct.description"
                name="description"
                rows="3"
              ></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Categor√≠a</label>
                <select
                  class="form-select"
                  [(ngModel)]="currentProduct.category"
                  name="category"
                  required
                >
                  <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                  <option value="Oficina">Oficina</option>
                  <option value="Industrial">Industrial</option>
                  <option value="Consumo">Consumo</option>
                  <option value="Otros">Otros</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Precio Unitario (S/.)</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="currentProduct.price"
                  name="price"
                  step="0.01"
                  min="0"
                  required
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Stock Actual</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="currentProduct.stock"
                  name="stock"
                  min="0"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Stock M√≠nimo</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="currentProduct.minStock"
                  name="minStock"
                  min="0"
                  required
                />
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button class="btn btn-primary" (click)="saveProduct()">
            {{ isEditing ? "Actualizar" : "Guardar" }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
