<div class="page-header clientes">
  <div class="page-header-content">
    <div>
      <h1 class="page-title">Gestión de Clientes</h1>
      <p class="page-subtitle">
        Administración integral de la cartera de clientes
      </p>
    </div>
    <div class="page-actions">
      <button class="btn btn-primary" (click)="toggleFormulario()">
        <i class="fas fa-plus"></i>
        Nuevo Cliente
      </button>
    </div>
  </div>
</div>

<div class="clientes-container">
  <div *ngIf="loading" class="loading-spinner">Cargando clientes...</div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Modal para agregar/editar cliente -->
  <div class="modal show" *ngIf="mostrarFormulario" (click)="toggleFormulario()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">{{ clienteEditando ? "Editar Cliente" : "Nuevo Cliente" }}</h2>
          <button class="btn-close" (click)="toggleFormulario()">✕</button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="guardarCliente()" #clienteForm="ngForm">
            <div class="form-row">
              <div class="form-group">
                <label for="nombre">Nombre:</label>
                <input
                  type="text"
                  id="nombre"
                  [(ngModel)]="clienteTemp.nombre"
                  name="nombre"
                  required
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="empresa">Empresa:</label>
                <input
                  type="text"
                  id="empresa"
                  [(ngModel)]="clienteTemp.empresa"
                  name="empresa"
                  required
                  class="form-control"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="email">Email:</label>
                <input
                  type="email"
                  id="email"
                  [(ngModel)]="clienteTemp.email"
                  name="email"
                  required
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="telefono">Teléfono:</label>
                <input
                  type="tel"
                  id="telefono"
                  [(ngModel)]="clienteTemp.telefono"
                  name="telefono"
                  required
                  class="form-control"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="direccion">Dirección:</label>
                <input
                  type="text"
                  id="direccion"
                  [(ngModel)]="clienteTemp.direccion"
                  name="direccion"
                  required
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="categoria">Categoría:</label>
                <select
                  id="categoria"
                  [(ngModel)]="clienteTemp.categoria"
                  name="categoria"
                  required
                  class="form-select"
                >
                  <option value="Premium">Premium</option>
                  <option value="Corporativo">Corporativo</option>
                  <option value="Regular">Regular</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="isActive">Estado:</label>
                <select
                  id="isActive"
                  [(ngModel)]="clienteTemp.isActive"
                  name="isActive"
                  required
                  class="form-select"
                >
                  <option [value]="true">Activo</option>
                  <option [value]="false">Inactivo</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                (click)="cancelarEdicion(); toggleFormulario()"
              >
                Cancelar
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="!clienteForm.form.valid"
              >
                {{ clienteEditando ? "Actualizar" : "Guardar" }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas de clientes -->
  <div class="stats-container">
    <div class="stat-card">
      <h3>Total Clientes</h3>
      <p class="stat-number">{{ clientes.length }}</p>
    </div>
    <div class="stat-card">
      <h3>Clientes Premium</h3>
      <p class="stat-number">{{ contarPorCategoria("Premium") }}</p>
    </div>
    <div class="stat-card">
      <h3>Clientes Corporativos</h3>
      <p class="stat-number">{{ contarPorCategoria("Corporativo") }}</p>
    </div>
    <div class="stat-card">
      <h3>Clientes Regulares</h3>
      <p class="stat-number">{{ contarPorCategoria("Regular") }}</p>
    </div>
  </div>

  <!-- Tabla de clientes -->
  <div class="tabla-container">
    <table class="clientes-table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Empresa</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Categoría</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cliente of clientes">
          <td>{{ cliente.nombre }}</td>
          <td>{{ cliente.empresa }}</td>
          <td>{{ cliente.email }}</td>
          <td>{{ cliente.telefono }}</td>
          <td>
            <span
              class="categoria-badge"
              [ngClass]="'categoria-' + cliente.categoria.toLowerCase()"
            >
              {{ getCategoriaBadge(cliente.categoria) }} {{ cliente.categoria }}
            </span>
          </td>
          <td>
            <span
              class="estado-badge"
              [ngClass]="cliente.isActive ? 'activo' : 'inactivo'"
            >
              {{ cliente.isActive ? "Activo" : "Inactivo" }}
            </span>
          </td>
          <td class="acciones">
            <button
              class="action-btn action-btn-edit"
              (click)="editarCliente(cliente)"
              title="Editar"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="action-btn action-btn-delete"
              (click)="eliminarCliente(cliente.id!)"
              title="Eliminar"
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
