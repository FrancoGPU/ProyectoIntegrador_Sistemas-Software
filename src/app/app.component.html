

<div class="app-container">
  <nav class="navbar" *ngIf="!isLoginPage">
    <div class="navbar-content">
      <div class="logo">LogiStock Solutions</div>
      <!-- Menú para escritorio -->
      <ul class="nav-menu-desktop">
        <!-- Enlaces para ADMIN -->
        <ng-container *ngIf="authService.isAdmin()">
          <li class="nav-item"><a routerLink="/dashboard" routerLinkActive="active">Dashboard</a></li>
          <li class="nav-item"><a routerLink="/inventario" routerLinkActive="active">Inventario</a></li>
          <li class="nav-item"><a routerLink="/clientes" routerLinkActive="active">Clientes</a></li>
          <li class="nav-item"><a routerLink="/proveedores" routerLinkActive="active">Proveedores</a></li>
          <li class="nav-item"><a routerLink="/rutas" routerLinkActive="active">Rutas</a></li>
          <li class="nav-item"><a routerLink="/pedidos" routerLinkActive="active">Pedidos</a></li>
          <li class="nav-item"><a routerLink="/reportes" routerLinkActive="active">Reportes</a></li>
          <li class="nav-item">
            <button class="btn-new-admin" (click)="openAdminModal()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="16" height="16">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              Nuevo Admin
            </button>
          </li>
        </ng-container>

        <!-- Enlaces para USER (Delivery) -->
        <ng-container *ngIf="!authService.isAdmin() && authService.isAuthenticated()">
          <li class="nav-item"><a routerLink="/entregas" routerLinkActive="active">Mis Entregas</a></li>
        </ng-container>

        <li class="nav-item user-menu" *ngIf="authService.isAuthenticated()">
          <span class="user-info">{{ authService.currentUserValue?.username }} ({{ authService.currentUserValue?.role }})</span>
          <button class="logout-button" (click)="logout()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Cerrar Sesión
          </button>
        </li>
      </ul>
      <div class="hamburger" [class.active]="isMenuOpen" (click)="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </nav>
  
  <!-- Overlay para menú móvil -->
  <div class="menu-overlay" [class.active]="isMenuOpen" (click)="closeMenu()" *ngIf="!isLoginPage"></div>
  
  <!-- Menú móvil independiente -->
  <ul class="nav-menu" [class.open]="isMenuOpen" *ngIf="!isLoginPage">
    <!-- Enlaces para ADMIN -->
    <ng-container *ngIf="authService.isAdmin()">
      <li class="nav-item"><a routerLink="/dashboard" routerLinkActive="active" (click)="closeMenu()">Dashboard</a></li>
      <li class="nav-item"><a routerLink="/inventario" routerLinkActive="active" (click)="closeMenu()">Inventario</a></li>
      <li class="nav-item"><a routerLink="/clientes" routerLinkActive="active" (click)="closeMenu()">Clientes</a></li>
      <li class="nav-item"><a routerLink="/proveedores" routerLinkActive="active" (click)="closeMenu()">Proveedores</a></li>
      <li class="nav-item"><a routerLink="/rutas" routerLinkActive="active" (click)="closeMenu()">Rutas</a></li>
      <li class="nav-item"><a routerLink="/pedidos" routerLinkActive="active" (click)="closeMenu()">Pedidos</a></li>
      <li class="nav-item"><a routerLink="/reportes" routerLinkActive="active" (click)="closeMenu()">Reportes</a></li>
    </ng-container>

    <!-- Enlaces para USER (Delivery) -->
    <ng-container *ngIf="!authService.isAdmin() && authService.isAuthenticated()">
      <li class="nav-item"><a routerLink="/entregas" routerLinkActive="active" (click)="closeMenu()">Mis Entregas</a></li>
    </ng-container>

    <li class="nav-item user-info-mobile" *ngIf="authService.isAuthenticated()">
      <span>{{ authService.currentUserValue?.username }}</span>
      <span class="role-badge">{{ authService.currentUserValue?.role }}</span>
    </li>
    <li class="nav-item logout-item" *ngIf="authService.isAuthenticated()">
      <button class="logout-button-mobile" (click)="logout()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Cerrar Sesión
      </button>
    </li>
  </ul>
  
  <main class="main-content" [class.no-navbar]="isLoginPage">
    <router-outlet></router-outlet>
  </main>

  <!-- Modal para crear Admin -->
  <div class="modal-overlay" *ngIf="showAdminModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Crear Nuevo Administrador</h3>
        <button class="close-button" (click)="closeAdminModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createAdmin()">
          <div class="form-group">
            <label>Usuario</label>
            <input type="text" [(ngModel)]="adminUsername" name="adminUsername" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="adminEmail" name="adminEmail" required>
          </div>
          <div class="form-group">
            <label>Contraseña</label>
            <input type="password" [(ngModel)]="adminPassword" name="adminPassword" required>
          </div>
          <div class="form-group">
            <label>Confirmar Contraseña</label>
            <input type="password" [(ngModel)]="adminConfirmPassword" name="adminConfirmPassword" required>
          </div>
          <div class="error-message" *ngIf="adminError">{{ adminError }}</div>
          <div class="modal-actions">
            <button type="button" class="btn-cancel" (click)="closeAdminModal()">Cancelar</button>
            <button type="submit" class="btn-submit" [disabled]="adminLoading">
              {{ adminLoading ? 'Creando...' : 'Crear Admin' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
